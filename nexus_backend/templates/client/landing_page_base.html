{% load static i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% get_available_languages as LANGUAGES %}
{% get_language_info_list for LANGUAGES as languages %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% trans "Nexus | Customer Dashboard" %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    @keyframes fade-in { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:none} }
    .animate-fade-in{ animation:fade-in .45s ease both; }
    @keyframes gradient-move { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .animate-gradient{ background-size:200% 200%; animation:gradient-move 6s ease infinite; }

    .sidebar-drawer{ transform:translateX(100%); transition:transform .3s ease; }
    .sidebar-drawer.open{ transform:translateX(0); }
  </style>
</head>

<body class="bg-gray-50 text-gray-800">

  <!-- PAGE WRAPPER: makes footer stick to bottom -->
  <div class="min-h-screen flex flex-col">

    <!-- CONTENT WRAPPER: takes remaining height -->
    <div class="flex-1 grid grid-cols-1 md:grid-cols-[16rem_minmax(0,1fr)]">

      <!-- ===== Desktop Sidebar ===== -->
      {% include 'menus/mobile_client/menus.html' %}

      <!-- ===== Main ===== -->
      <main class="flex-1 w-full min-w-0">
        <!-- Topbar -->
        <div class="sticky top-0 z-30 bg-gray-50/70 backdrop-blur border-b">
          <div class="w-full px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
            <h1 class="text-2xl md:text-3xl font-extrabold bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 bg-clip-text text-transparent animate-gradient">
              {% trans "Welcome" %}, {{ full_name }}
            </h1>

              <!-- Language Switcher (desktop) -->
      <form action="{% url 'set_language' %}" method="post" class="relative hidden md:block">
        {% csrf_token %}
        <input type="hidden" name="next" value="{{ request.get_full_path }}">
        <button type="button" id="langButton"
                class="inline-flex items-center gap-2 px-3 py-2 rounded-lg border bg-white shadow-sm text-sm hover:bg-gray-50">
          <i class="fas fa-globe text-gray-500"></i>
          <span class="font-medium">
            {% for lang in languages %}
              {% if lang.code == LANGUAGE_CODE %}{{ lang.name_local }}{% endif %}
            {% endfor %}
          </span>
          <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
        </button>
        <div id="langMenu"
             class="absolute right-0 mt-2 w-44 bg-white border rounded-lg shadow-lg py-1 hidden z-50">
          {% for lang in languages %}
            <button type="submit" name="language" value="{{ lang.code }}"
                    class="w-full text-left px-3 py-2 text-sm hover:bg-gray-50 flex items-center justify-between">
              <span>{{ lang.name_local }}</span>
              {% if lang.code == LANGUAGE_CODE %}
                <i class="fas fa-check text-blue-600"></i>
              {% endif %}
            </button>
          {% endfor %}
        </div>
      </form>

            <button class="md:hidden p-3 rounded-lg shadow bg-gradient-to-r from-blue-500 to-indigo-500 text-white"
                    onclick="toggleMobileSidebar(true)">
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>

        <!-- Content container -->
        <div class="w-full px-4 sm:px-6 lg:px-8 py-6 space-y-8">
          <section class="w-full">
            {% block content %}{% endblock %}
          </section>
        </div>
      </main>
      <!-- /Main -->

    </div>
    <!-- /CONTENT WRAPPER -->

    <!-- Mobile overlay & drawer (fixed; doesn’t affect layout height) -->
    <div id="mobile-overlay" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="toggleMobileSidebar(false)"></div>
    {% include 'menus/mobile_client/mobile_menu.html' %}

    <!-- ===== Footer (now always at bottom) ===== -->
    <footer class="bg-white border-t text-sm text-gray-500 text-center py-4">
      <div class="max-w-7xl mx-auto px-4">
        <p>&copy; 2025 Nexus Telecom – {% trans "All rights reserved." %}</p>
        <p class="mt-1">
          <a href="#" class="hover:text-blue-600">{% trans "Terms" %}</a> ·
          <a href="#" class="hover:text-blue-600">{% trans "Privacy" %}</a> ·
          <a href="#" class="hover:text-blue-600">{% trans "Contact" %}</a>
        </p>
      </div>
    </footer>

  </div>
  <!-- /PAGE WRAPPER -->

  <script>
    function toggleElement(id, show = true) {
      const el = document.getElementById(id);
      if (el) el.classList.toggle("hidden", !show);
    }

    function toggleMobileSidebar(open) {
      const sidebar = document.getElementById('mobileSidebar');
      const overlay = document.getElementById('mobile-overlay');
      if (open) {
        sidebar.classList.add('open');
        overlay.classList.remove('hidden');
      } else {
        sidebar.classList.remove('open');
        overlay.classList.add('hidden');
      }
    }

    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') toggleMobileSidebar(false);
    });

    // desktop language dropdown
    (function () {
      const btn = document.getElementById('langButton');
      const menu = document.getElementById('langMenu');
      if (!btn || !menu) return;
      btn.addEventListener('click', () => menu.classList.toggle('hidden'));
      document.addEventListener('click', (e) => {
        if (!btn.contains(e.target) && !menu.contains(e.target)) menu.classList.add('hidden');
      });
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') menu.classList.add('hidden');
      });
    })();


  </script>

</div>
{# Inclusion du modal KYC et de son script juste avant la fermeture du body pour garantir la portée globale #}
{% include 'partials/kyc_modal.html' %}
</body>
</html>
