{% load static i18n %}
{% get_current_language as LANGUAGE_CODE %}
{% get_available_languages as LANGUAGES %}
{% get_language_info_list for LANGUAGES as languages %}

<aside id="mobileSidebar"
       class="sidebar-drawer fixed right-0 top-0 h-full w-72 z-50 bg-white shadow-2xl md:hidden"
       aria-label="{% trans 'Mobile menu' %}">

  <!-- Header -->
  <div class="sticky top-0 bg-white border-b px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <i class="fas fa-bars text-gray-400"></i>
      <span class="text-sm font-semibold text-gray-700">{% trans "Menu" %}</span>
    </div>
    <button onclick="toggleMobileSidebar(false)"
            class="text-gray-400 hover:text-gray-600"
            aria-label="{% trans 'Close menu' %}">
      <i class="fas fa-times fa-lg"></i>
    </button>
  </div>

  <!-- Language selector -->
  <div class="px-4 pt-3">
    <form action="{% url 'set_language' %}" method="post" class="mb-3">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ request.get_full_path }}">
      <label for="mobile-lang" class="sr-only">{% trans "Language" %}</label>
      <div class="flex items-center gap-2">
        <i class="fas fa-globe text-gray-400"></i>
        <select id="mobile-lang" name="language"
                class="flex-1 px-3 py-2 rounded-lg border bg-white shadow-sm text-sm"
                onchange="this.form.submit()">
          {% for lang in languages %}
            <option value="{{ lang.code }}" {% if lang.code == LANGUAGE_CODE %}selected{% endif %}>
              {{ lang.name_local }}
            </option>
          {% endfor %}
        </select>
      </div>
    </form>
  </div>

  <!-- Nav -->
  <nav class="px-4 pb-6 space-y-1 text-sm">
    <!-- Dashboard -->
    <a href="{% if kyc_status == 'approved' %}{% url 'dashboard' %}{% endif %}"
       class="flex items-center gap-3 px-4 py-3 rounded-xl
              {% if request.resolver_match.url_name == 'dashboard' %}
                bg-blue-50 text-blue-700 ring-1 ring-blue-200
              {% elif kyc_status != 'approved' %}
                text-gray-400 opacity-50 cursor-not-allowed
              {% else %}
                hover:bg-blue-50 hover:text-blue-700 text-gray-700
              {% endif %}">
      <i class="fas fa-gauge w-5
                {% if request.resolver_match.url_name == 'dashboard' %}text-blue-600{% elif kyc_status != 'approved' %}text-gray-400{% else %}text-blue-500{% endif %}"></i>
      {% trans "Dashboard" %}
    </a>

    <!-- Subscriptions -->
    <a href="{% if kyc_status == 'approved' %}{% url 'subscription_list' %}{% endif %}"
       class="flex items-center gap-3 px-4 py-3 rounded-xl
              {% if request.resolver_match.url_name == 'subscription_list' %}
                bg-blue-50 text-blue-700 ring-1 ring-blue-200
              {% elif kyc_status != 'approved' %}
                text-gray-400 opacity-50 cursor-not-allowed
              {% else %}
                hover:bg-blue-50 hover:text-blue-700 text-gray-700
              {% endif %}">
      <i class="fas fa-satellite-dish w-5
                {% if request.resolver_match.url_name == 'subscription_list' %}text-blue-600{% elif kyc_status != 'approved' %}text-gray-400{% else %}text-blue-500{% endif %}"></i>
      {% trans "Subscriptions" %}
    </a>

    {% if kyc_status == 'approved' %}
    <!-- Orders -->
    <a href="{% url 'orders_page' %}"
       class="flex items-center gap-3 px-4 py-3 rounded-xl
              {% if request.resolver_match.url_name == 'orders_page' %}
                bg-blue-50 text-blue-700 ring-1 ring-blue-200
              {% else %}
                hover:bg-blue-50 hover:text-blue-700 text-gray-700
              {% endif %}">
      <i class="fas fa-shopping-cart w-5
                {% if request.resolver_match.url_name == 'orders_page' %}text-blue-600{% else %}text-blue-500{% endif %}"></i>
      {% trans "Orders" %}
    </a>
    {% endif %}

    <!-- Billing -->
    <a href="{% if kyc_status == 'approved' %}{% url 'billing_page' %}{% endif %}"
       class="flex items-center gap-3 px-4 py-3 rounded-xl
              {% if request.resolver_match.url_name == 'billing_page' %}
                bg-blue-50 text-blue-700 ring-1 ring-blue-200
              {% elif kyc_status != 'approved' %}
                text-gray-400 opacity-50 cursor-not-allowed
              {% else %}
                hover:bg-blue-50 hover:text-blue-700 text-gray-700
              {% endif %}">
      <i class="fas fa-file-invoice-dollar w-5
                {% if request.resolver_match.url_name == 'billing_page' %}text-blue-600{% elif kyc_status != 'approved' %}text-gray-400{% else %}text-blue-500{% endif %}"></i>
      {% trans "Billing" %}
    </a>

    <!-- Messages -->
    <a href="{% url 'support_page' %}"
       class="flex items-center gap-3 px-4 py-3 rounded-xl
              {% if request.resolver_match.url_name == 'support_page' %}
                bg-blue-50 text-blue-700 ring-1 ring-blue-200
              {% else %}
                hover:bg-blue-50 hover:text-blue-700 text-gray-700
              {% endif %}">
      <i class="fas fa-comments w-5
                {% if request.resolver_match.url_name == 'support_page' %}text-blue-600{% else %}text-blue-500{% endif %}"></i>
      {% trans "Support" %}
    </a>

    <!-- Settings -->
    <a href="{% url 'settings' %}"
       class="flex items-center gap-3 px-4 py-3 rounded-xl
              {% if request.resolver_match.url_name == 'settings' %}
                bg-blue-50 text-blue-700 ring-1 ring-blue-200
              {% else %}
                hover:bg-blue-50 hover:text-blue-700 text-gray-700
              {% endif %}">
      <i class="fas fa-cog w-5
                {% if request.resolver_match.url_name == 'settings' %}text-blue-600{% else %}text-blue-500{% endif %}"></i>
      {% trans "Settings" %}
    </a>

    <div class="my-2 border-t"></div>

    <!-- Logout -->
    <a href="{% url 'logout_request' %}"
       class="flex items-center gap-3 px-4 py-3 rounded-xl text-red-600 hover:bg-red-50 hover:text-red-700">
      <i class="fas fa-sign-out-alt w-5"></i>
      {% trans "Logout" %}
    </a>
  </nav>
</aside>
