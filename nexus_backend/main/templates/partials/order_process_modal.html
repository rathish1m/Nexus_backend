{% load static i18n %}
{% get_current_language as LANGUAGE_CODE %}

<!-- Order Modal -->
<div id="orderModal" class="fixed inset-0 bg-black bg-opacity-60 hidden z-50 flex items-center justify-center px-4">
  <div class="bg-white rounded-lg shadow-lg p-6 max-w-xl w-full relative">

    <!-- Close Button -->
    <button onclick="closeOrderModal()" class="absolute top-2 right-4 text-gray-600 text-xl hover:text-gray-900">
      &times;
    </button>

    <h2 class="text-xl font-bold mb-4 text-gray-800">{% trans "Order your Starlink or Subscription" %}</h2>

    <form id="orderForm" method="post" action="/checkout/">
      {% csrf_token %}

      <!-- Kit Selection -->
<div class="mb-4">
  <label for="kitType" class="block text-sm font-medium mb-1 text-gray-700">{% trans "Select Kit Type" %}</label>
  <div class="relative">
    <select id="kitType" name="kit_type"
            class="block w-full appearance-none border border-gray-300 bg-white px-4 py-3 pr-8 rounded-md text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-base">
      <option value="">{% trans "-- Choose Kit --" %}</option>
    </select>
    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
      <svg class="h-4 w-4 fill-current" viewBox="0 0 20 20">
        <path d="M7 7l3-3 3 3m0 6l-3 3-3-3" />
      </svg>
    </div>
  </div>
</div>

<!-- Plan Selection -->
<div class="mb-4">
  <label for="subscriptionPlan" class="block text-sm font-medium mb-1 text-gray-700">{% trans "Subscription Plan" %}</label>
  <div class="relative">
    <select id="subscriptionPlan" name="subscription_plan"
            class="block w-full appearance-none border border-gray-300 bg-white px-4 py-3 pr-8 rounded-md text-sm shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-base">
      <option value="">{% trans "-- Select Plan --" %}</option>
    </select>
    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
      <svg class="h-4 w-4 fill-current" viewBox="0 0 20 20">
        <path d="M7 7l3-3 3 3m0 6l-3 3-3-3" />
      </svg>
    </div>
  </div>
</div>

      <!-- Installation Address -->
      <div class="mb-4">
        <label for="manualAddress" class="block text-sm font-medium text-gray-700 mb-1">
          {% trans "Installation Address" %}
        </label>
        <input type="text" id="manualAddress" name="manual_address" placeholder="Start typing address..."
               class="w-full border px-3 py-2 rounded text-sm focus:ring focus:border-blue-300 mb-2">

        <div id="map" class="w-full h-64 rounded border"></div>
        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">
        <input type="hidden" name="install_fee_usd" id="installFeeUsdField">
        <p class="text-xs text-gray-500 mt-1">{% trans "Click on map or search address to set location." %}</p>
      </div>

      <!-- Assisted Installation -->
      <div class="mb-4">
        <label class="inline-flex items-center">
          <input type="checkbox" id="assistedInstallCheckbox" name="assisted_installation" class="mr-2">
          <span>{% trans "Request Assisted Installation" %}</span>
        </label>

        <div id="installFeeDisplay" class="mt-2 text-sm text-gray-600 hidden">
          <span>{% trans "Installation Fee" %}:</span>
          <span id="installFeeValue" class="font-semibold text-blue-700">$0.00</span>
        </div>
      </div>

      <!-- Summary -->
      <div id="orderSummary" class="bg-gray-50 border rounded p-3 text-sm text-gray-700 mb-4 hidden">
        <p><strong>{% trans "Kit" %}:</strong> <span id="kitLabel"></span></p>
        <p><strong>{% trans "Plan" %}:</strong> <span id="planLabel"></span></p>
        <hr class="my-2">
        <p><strong>{% trans "Kit Fee (One-Time)" %}:</strong>
          <span id="kitFee" class="text-blue-700 font-semibold">$0.00</span></p>
        <p><strong>{% trans "Installation Fee (One-Time)" %}:</strong>
          <span id="installFee" class="text-blue-700 font-semibold">$0.00</span></p>
        <p><strong>{% trans "Monthly Subscription Fee" %}:</strong>
          <span id="monthlyFee" class="text-green-700 font-semibold">$0.00</span></p>
        <hr class="my-2">
        <p><strong>{% trans "Total Due Now" %}:</strong>
          <span id="totalDueNow" class="text-purple-700 font-bold">$0.00</span></p>
        <p><strong>{% trans "Monthly Total" %}:</strong>
          <span id="totalMonthly" class="text-green-700 font-bold">$0.00</span></p>
      </div>

      <!-- Terms -->
      <label class="flex items-center gap-2 text-sm mb-4">
        <input type="checkbox" required>
        {% trans "I agree to the Terms and Conditions" %}
      </label>

      <!-- Submit -->
      <button type="submit" class="bg-green-600 text-white w-full py-2 rounded hover:bg-green-700 font-semibold">
        {% trans "Confirm Order" %}
      </button>
    </form>
  </div>
</div>
