# Generated by Django 5.2.1 on 2025-11-17 07:14

import django.contrib.auth.models
import django.contrib.auth.validators
import django.contrib.postgres.indexes
import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import main.models
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ("auth", "0012_alter_user_first_name_max_length"),
        ("geo_regions", "0001_initial"),
    ]

    operations = [
        migrations.CreateModel(
            name="AdditionalDataRate",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "kit_type_name",
                    models.CharField(
                        choices=[("standard", "Standard Kit"), ("mini", "Mini Kit")], default="standard", max_length=20
                    ),
                ),
                ("price_per_gb", models.DecimalField(decimal_places=2, max_digits=6)),
                ("is_active", models.BooleanField(default=True)),
            ],
        ),
        migrations.CreateModel(
            name="APIEndpoint",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "name",
                    models.CharField(
                        help_text="Human-readable name (e.g. 'FlexPay Mobile Money')", max_length=100, unique=True
                    ),
                ),
                (
                    "code",
                    models.CharField(help_text="Unique identifier (e.g. 'flexpay_mobile')", max_length=50, unique=True),
                ),
                ("url", models.URLField(help_text="Full API endpoint URL")),
                ("method", models.CharField(default="POST", help_text="HTTP method (GET, POST, etc.)", max_length=10)),
                (
                    "environment",
                    models.CharField(
                        choices=[("production", "Production"), ("staging", "Staging"), ("sandbox", "Sandbox")],
                        default="production",
                        max_length=20,
                    ),
                ),
                ("active", models.BooleanField(default=True)),
                ("description", models.TextField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={
                "verbose_name": "API Endpoint",
                "verbose_name_plural": "API Endpoints",
            },
        ),
        migrations.CreateModel(
            name="BillingConfig",
            fields=[
                ("id", models.PositiveSmallIntegerField(default=1, editable=False, primary_key=True, serialize=False)),
                (
                    "anchor_day",
                    models.PositiveSmallIntegerField(
                        default=20,
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(28),
                        ],
                    ),
                ),
                (
                    "prebill_lead_days",
                    models.PositiveSmallIntegerField(
                        default=5,
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(30),
                        ],
                    ),
                ),
                ("invoice_start_date", models.DateField(blank=True, null=True)),
                (
                    "cutoff_days_before_anchor",
                    models.PositiveSmallIntegerField(
                        default=1,
                        help_text="Days before anchor to enforce service cutoff (e.g. 1 = D-1).",
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(30),
                        ],
                    ),
                ),
                (
                    "auto_suspend_on_cutoff",
                    models.BooleanField(
                        default=True, help_text="Suspend subscriptions automatically at cutoff if unpaid."
                    ),
                ),
                (
                    "auto_apply_wallet",
                    models.BooleanField(default=True, help_text="Automatically apply wallet to renewal invoices."),
                ),
                (
                    "align_first_cycle_to_anchor",
                    models.BooleanField(default=True, help_text="Align a new subscription to the global anchor date."),
                ),
                (
                    "first_cycle_included_in_order",
                    models.BooleanField(
                        default=True, help_text="First month already charged on initial hardware/order invoice."
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
        ),
        migrations.CreateModel(
            name="CompanySettings",
            fields=[
                ("id", models.PositiveSmallIntegerField(default=1, editable=False, primary_key=True, serialize=False)),
                ("legal_name", models.CharField(blank=True, default="", max_length=150, verbose_name="Legal name")),
                ("trade_name", models.CharField(blank=True, default="", max_length=150, verbose_name="Trade name")),
                ("email", models.EmailField(blank=True, default="", max_length=254, verbose_name="Primary email")),
                ("phone", models.CharField(blank=True, default="", max_length=50, verbose_name="Primary phone")),
                ("website", models.URLField(blank=True, default="", verbose_name="Website")),
                (
                    "street_address",
                    models.CharField(blank=True, default="", max_length=255, verbose_name="Full address"),
                ),
                ("city", models.CharField(blank=True, default="", max_length=120, verbose_name="City")),
                ("province", models.CharField(blank=True, default="", max_length=120, verbose_name="Province / State")),
                ("country", models.CharField(blank=True, default="DRC", max_length=120, verbose_name="Country")),
                ("postal_code", models.CharField(blank=True, default="", max_length=40, verbose_name="Postal code")),
                (
                    "timezone",
                    models.CharField(
                        blank=True,
                        default="Africa/Lubumbashi",
                        help_text="IANA timezone name (e.g., Africa/Lubumbashi, Africa/Kinshasa).",
                        max_length=64,
                        verbose_name="Timezone",
                    ),
                ),
                ("rccm", models.CharField(blank=True, default="", max_length=60, verbose_name="RCCM")),
                ("id_nat", models.CharField(blank=True, default="", max_length=60, verbose_name="Id.Nat")),
                ("nif", models.CharField(blank=True, default="", max_length=60, verbose_name="NIF (Tax ID)")),
                (
                    "arptc_license",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="License number (if applicable).",
                        max_length=120,
                        verbose_name="ARPTC License",
                    ),
                ),
                (
                    "tax_regime",
                    models.CharField(
                        choices=[
                            ("normal", "Normal VAT regime"),
                            ("simplified", "Simplified regime"),
                            ("exempt", "VAT-exempt regime"),
                        ],
                        default="normal",
                        max_length=20,
                        verbose_name="Tax regime",
                    ),
                ),
                (
                    "vat_rate_percent",
                    models.DecimalField(
                        decimal_places=2,
                        default=Decimal("16.00"),
                        help_text="Standard VAT rate (e.g., 16.00).",
                        max_digits=5,
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(100),
                        ],
                        verbose_name="VAT rate (%)",
                    ),
                ),
                (
                    "excise_rate_percent",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Excise duty rate in % (optional).",
                        max_digits=5,
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(100),
                        ],
                        verbose_name="Excise rate (%)",
                    ),
                ),
                (
                    "invoice_prefix",
                    models.CharField(blank=True, default="INV", max_length=12, verbose_name="Invoice prefix"),
                ),
                ("next_invoice_number", models.PositiveIntegerField(default=1, verbose_name="Next invoice number")),
                (
                    "reset_number_annually",
                    models.BooleanField(
                        default=False,
                        help_text="If enabled, numbering resets to 1 each new calendar year.",
                        verbose_name="Reset numbering annually",
                    ),
                ),
                (
                    "default_currency",
                    models.CharField(
                        default="USD", help_text="USD or CDF.", max_length=3, verbose_name="Default currency"
                    ),
                ),
                ("payment_terms_days", models.PositiveIntegerField(default=7, verbose_name="Payment terms (days)")),
                (
                    "show_prices_in_cdf",
                    models.BooleanField(
                        default=False,
                        help_text="Display CDF equivalent on invoices.",
                        verbose_name="Show equivalent amount in CDF",
                    ),
                ),
                ("bank_name", models.CharField(blank=True, default="", max_length=120, verbose_name="Bank name")),
                (
                    "bank_account_name",
                    models.CharField(blank=True, default="", max_length=120, verbose_name="Account holder name"),
                ),
                ("bank_swift", models.CharField(blank=True, default="", max_length=40, verbose_name="SWIFT / BIC")),
                ("bank_branch", models.CharField(blank=True, default="", max_length=120, verbose_name="Bank branch")),
                ("bank_iban", models.CharField(blank=True, default="", max_length=120, verbose_name="IBAN")),
                (
                    "bank_account_number_usd",
                    models.CharField(blank=True, default="", max_length=120, verbose_name="Account number (USD)"),
                ),
                (
                    "bank_account_number_cdf",
                    models.CharField(blank=True, default="", max_length=120, verbose_name="Account number (CDF)"),
                ),
                (
                    "mm_provider",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="e.g., M-Pesa, Airtel Money, Orange Money.",
                        max_length=120,
                        verbose_name="Mobile Money provider",
                    ),
                ),
                (
                    "mm_number",
                    models.CharField(blank=True, default="", max_length=60, verbose_name="Mobile Money number"),
                ),
                ("payment_instructions", models.TextField(blank=True, default="", verbose_name="Payment instructions")),
                ("footer_text_fr", models.TextField(blank=True, default="", verbose_name="Invoice footer (FR)")),
                ("footer_text_en", models.TextField(blank=True, default="", verbose_name="Invoice footer (EN)")),
                (
                    "logo",
                    models.ImageField(blank=True, null=True, upload_to="branding/logo/", verbose_name="Company logo"),
                ),
                (
                    "stamp",
                    models.ImageField(blank=True, null=True, upload_to="branding/stamp/", verbose_name="Company stamp"),
                ),
                (
                    "signature",
                    models.ImageField(
                        blank=True, null=True, upload_to="branding/signature/", verbose_name="Signature image"
                    ),
                ),
                (
                    "signatory_name",
                    models.CharField(blank=True, default="", max_length=120, verbose_name="Signatory name"),
                ),
                (
                    "signatory_title",
                    models.CharField(blank=True, default="", max_length=120, verbose_name="Signatory title/role"),
                ),
                (
                    "tax_office_name",
                    models.CharField(blank=True, default="", max_length=150, verbose_name="Tax office / Directorate"),
                ),
                ("legal_notes", models.TextField(blank=True, default="", verbose_name="Additional legal notes")),
                ("updated_at", models.DateTimeField(auto_now=True, verbose_name="Last updated")),
            ],
            options={
                "verbose_name": "Company Settings",
                "verbose_name_plural": "Company Settings",
            },
        ),
        migrations.CreateModel(
            name="Country",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
            ],
        ),
        migrations.CreateModel(
            name="OptionalService",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("name", models.CharField(max_length=100)),
                ("description", models.TextField(blank=True)),
                ("price_usd", models.DecimalField(decimal_places=2, max_digits=8)),
            ],
        ),
        migrations.CreateModel(
            name="PaymentMethod",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "name",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("CASH", "Cash"),
                            ("MOBILE_MONEY", "Mobile Money"),
                            ("CREDIT_CARD", "Credit Card"),
                            ("BANK_TRANSFER", "Bank Transfer"),
                            ("PAYPAL", "PayPal"),
                        ],
                        max_length=50,
                        null=True,
                        unique=True,
                    ),
                ),
                ("description", models.TextField(blank=True, null=True)),
                ("enabled", models.BooleanField(default=True, verbose_name="Is Enabled")),
            ],
        ),
        migrations.CreateModel(
            name="StarlinkKit",
            fields=[
                ("id", models.AutoField(primary_key=True, serialize=False)),
                ("name", models.CharField(max_length=100, unique=True)),
                ("model", models.CharField(blank=True, max_length=50, null=True)),
                ("description", models.TextField(blank=True, null=True)),
                ("base_price_usd", models.DecimalField(decimal_places=2, max_digits=10)),
                (
                    "picture",
                    models.FileField(blank=True, null=True, upload_to=main.models.starlink_kit_image_upload_path),
                ),
                (
                    "kit_type",
                    models.CharField(
                        choices=[("standard", "Standard Kit"), ("mini", "Mini Kit")],
                        help_text="Type of Starlink kit - required field",
                        max_length=20,
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
            ],
        ),
        migrations.CreateModel(
            name="SubscriptionPlan",
            fields=[
                ("id", models.AutoField(primary_key=True, serialize=False)),
                ("name", models.CharField(max_length=100)),
                ("category_name", models.CharField(default="Standard Category", max_length=100)),
                ("category_description", models.TextField(blank=True, default="")),
                ("category_is_active", models.BooleanField(default=True)),
                (
                    "site_type",
                    models.CharField(
                        choices=[("fixed", "Fixed Site"), ("portable", "Portable Site"), ("flexible", "Flexible Site")],
                        help_text="Site type for the subscription plan",
                        max_length=20,
                    ),
                ),
                (
                    "plan_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("unlimited_standard", "Unlimited Standard Data"),
                            ("limited_standard", "Limited Standard Data"),
                            ("unlimited_with_priority", "Unlimited + Priority Data"),
                            ("smart_education", "Smart Education Impact"),
                            ("smart_health", "Smart Health / Community Impact"),
                        ],
                        max_length=30,
                        null=True,
                    ),
                ),
                (
                    "standard_data_gb",
                    models.IntegerField(blank=True, help_text="GB of standard data (null = unlimited)", null=True),
                ),
                (
                    "priority_data_gb",
                    models.IntegerField(blank=True, help_text="GB of priority data included", null=True),
                ),
                (
                    "starlink_plan_code",
                    models.CharField(
                        blank=True, help_text="Original Starlink plan identifier", max_length=100, null=True
                    ),
                ),
                (
                    "monthly_price_usd",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Monthly subscription price in USD",
                        max_digits=10,
                        null=True,
                    ),
                ),
                (
                    "additional_priority_rate",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Additional rate per GB for priority data beyond included amount",
                        max_digits=6,
                        null=True,
                    ),
                ),
                ("display_order", models.IntegerField(default=0, help_text="Display order")),
                ("is_active", models.BooleanField(default=True)),
                ("valid_from", models.DateField(blank=True, null=True)),
                ("valid_to", models.DateField(blank=True, null=True)),
            ],
        ),
        migrations.CreateModel(
            name="TaxRate",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "description",
                    models.CharField(
                        choices=[
                            ("VAT", "VAT"),
                            ("EXCISE", "Excise"),
                            ("CUSTOMS", "Customs Duty"),
                            ("SERVICE", "Service Tax"),
                            ("OTHER", "Other"),
                        ],
                        default="VAT",
                        max_length=50,
                    ),
                ),
                (
                    "percentage",
                    models.DecimalField(
                        decimal_places=2, help_text="Enter percentage value, e.g. 16.00 for 16%", max_digits=5
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="User",
            fields=[
                ("password", models.CharField(max_length=128, verbose_name="password")),
                ("last_login", models.DateTimeField(blank=True, null=True, verbose_name="last login")),
                (
                    "is_superuser",
                    models.BooleanField(
                        default=False,
                        help_text="Designates that this user has all permissions without explicitly assigning them.",
                        verbose_name="superuser status",
                    ),
                ),
                (
                    "username",
                    models.CharField(
                        error_messages={"unique": "A user with that username already exists."},
                        help_text="Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.",
                        max_length=150,
                        unique=True,
                        validators=[django.contrib.auth.validators.UnicodeUsernameValidator()],
                        verbose_name="username",
                    ),
                ),
                ("first_name", models.CharField(blank=True, max_length=150, verbose_name="first name")),
                ("last_name", models.CharField(blank=True, max_length=150, verbose_name="last name")),
                (
                    "is_staff",
                    models.BooleanField(
                        default=False,
                        help_text="Designates whether the user can log into this admin site.",
                        verbose_name="staff status",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True,
                        help_text="Designates whether this user should be treated as active. Unselect this instead of deleting accounts.",
                        verbose_name="active",
                    ),
                ),
                ("date_joined", models.DateTimeField(default=django.utils.timezone.now, verbose_name="date joined")),
                ("id_user", models.AutoField(primary_key=True, serialize=False)),
                ("full_name", models.CharField(max_length=50)),
                ("phone", models.CharField(blank=True, max_length=50, null=True, unique=True)),
                ("email", models.EmailField(blank=True, max_length=254, null=True, unique=True)),
                ("is_verified", models.BooleanField(default=False)),
                ("is_tax_exempt", models.BooleanField(default=False)),
                (
                    "roles",
                    models.JSONField(blank=True, default=list, help_text="List of user roles (multi-role support)"),
                ),
                ("groups", models.ManyToManyField(blank=True, related_name="customuser_set", to="auth.group")),
                (
                    "user_permissions",
                    models.ManyToManyField(blank=True, related_name="customuser_permissions", to="auth.permission"),
                ),
            ],
            options={
                "verbose_name": "user",
                "verbose_name_plural": "users",
                "abstract": False,
            },
            managers=[
                ("objects", django.contrib.auth.models.UserManager()),
            ],
        ),
        migrations.CreateModel(
            name="BillingAccount",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "user",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="billing_account",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Billing Account",
                "verbose_name_plural": "Billing Accounts",
            },
        ),
        migrations.CreateModel(
            name="CompanyKYC",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "status",
                    models.CharField(
                        choices=[("pending", "Pending"), ("approved", "Approved"), ("rejected", "Rejected")],
                        default="pending",
                        max_length=20,
                        verbose_name="KYC Status",
                    ),
                ),
                ("approved_at", models.DateTimeField(blank=True, null=True, verbose_name="Approval Date")),
                (
                    "rejection_reason",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("document_quality", "Poor document quality"),
                            ("document_expired", "Document expired"),
                            ("information_mismatch", "Information does not match document"),
                            ("incomplete_documents", "Incomplete documentation"),
                            ("invalid_document", "Invalid or fake document"),
                            ("other", "Other (specify in remarks)"),
                        ],
                        max_length=50,
                        null=True,
                        verbose_name="Rejection Reason",
                    ),
                ),
                ("rejected_at", models.DateTimeField(blank=True, null=True, verbose_name="Rejection Date")),
                ("remarks", models.TextField(blank=True, verbose_name="Remarks")),
                ("company_name", models.CharField(blank=True, max_length=100, null=True)),
                ("address", models.CharField(blank=True, max_length=70, null=True)),
                (
                    "established_date",
                    models.DateField(
                        blank=True,
                        help_text="Date when the company was legally established",
                        null=True,
                        verbose_name="Date Established",
                    ),
                ),
                (
                    "business_sector",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("agriculture", "Agriculture, Forestry and Fishing"),
                            ("mining", "Mining and Quarrying"),
                            ("manufacturing", "Manufacturing"),
                            ("utilities", "Electricity, Gas, Steam and Water Supply"),
                            ("construction", "Construction"),
                            ("trade", "Wholesale and Retail Trade"),
                            ("transport", "Transportation and Storage"),
                            ("accommodation", "Accommodation and Food Service"),
                            ("information", "Information and Communication"),
                            ("finance", "Financial and Insurance Activities"),
                            ("real_estate", "Real Estate Activities"),
                            ("professional", "Professional, Scientific and Technical Activities"),
                            ("administrative", "Administrative and Support Service Activities"),
                            ("public_admin", "Public Administration and Defence"),
                            ("education", "Education"),
                            ("health", "Human Health and Social Work Activities"),
                            ("arts", "Arts, Entertainment and Recreation"),
                            ("other_services", "Other Service Activities"),
                            ("household", "Household Activities"),
                            ("extraterritorial", "Extraterritorial Organizations"),
                            ("other", "Other"),
                        ],
                        help_text="Primary business sector/industry",
                        max_length=50,
                        null=True,
                        verbose_name="Business Sector",
                    ),
                ),
                (
                    "legal_status",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("sa", "Public Limited Company (SA)"),
                            ("sarl", "Limited Liability Company (SARL)"),
                            ("eurl", "Single-Person Limited Liability Company (EURL)"),
                            ("sas", "Simplified Joint Stock Company (SAS)"),
                            ("sasu", "Single-Person Simplified Joint Stock Company (SASU)"),
                            ("ei", "Individual Enterprise (EI)"),
                            ("auto_entrepreneur", "Self-Employed Entrepreneur"),
                            ("association", "Association"),
                            ("cooperative", "Cooperative"),
                            ("gie", "Economic Interest Group (GIE)"),
                            ("other", "Other"),
                        ],
                        help_text="Legal form/status of the company",
                        max_length=50,
                        null=True,
                        verbose_name="Legal Status",
                    ),
                ),
                ("rccm", models.CharField(blank=True, max_length=50, null=True)),
                ("nif", models.CharField(blank=True, max_length=50, null=True)),
                ("id_nat", models.CharField(blank=True, max_length=50, null=True)),
                ("representative_name", models.CharField(blank=True, max_length=100, null=True)),
                (
                    "representative_id_file",
                    models.FileField(blank=True, null=True, upload_to=main.models.representative_id_upload_path),
                ),
                (
                    "company_documents",
                    models.FileField(blank=True, null=True, upload_to=main.models.company_document_upload_path),
                ),
                ("submitted_at", models.DateTimeField(auto_now_add=True, null=True)),
                ("documents_count", models.PositiveIntegerField(default=0, editable=False)),
                (
                    "approved_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="%(class)s_approved_by",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="Approved By",
                    ),
                ),
                (
                    "rejected_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="%(class)s_rejected_by",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="Rejected By",
                    ),
                ),
                (
                    "user",
                    models.OneToOneField(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="company_kyc",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-submitted_at"],
            },
        ),
        migrations.CreateModel(
            name="CompanyDocument",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "document_type",
                    models.CharField(
                        choices=[
                            ("rccm", "RCCM Document"),
                            ("nif", "NIF Document"),
                            ("id_nat", "ID National"),
                            ("statutes", "Company Statutes"),
                            ("registration", "Registration Certificate"),
                            ("other", "Other Document"),
                        ],
                        default="other",
                        max_length=20,
                    ),
                ),
                ("document", models.FileField(upload_to=main.models.company_document_upload_path)),
                ("document_name", models.CharField(blank=True, max_length=255)),
                ("is_verified", models.BooleanField(default=False)),
                ("uploaded_at", models.DateTimeField(auto_now_add=True)),
                (
                    "company_kyc",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="documents", to="main.companykyc"
                    ),
                ),
            ],
            options={
                "ordering": ["-uploaded_at"],
            },
        ),
        migrations.CreateModel(
            name="ConsolidatedInvoice",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("number", models.CharField(blank=True, db_index=True, max_length=32, null=True)),
                ("total", models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ("currency", models.CharField(default="USD", max_length=10)),
                ("issued_at", models.DateTimeField(auto_now_add=True)),
                ("due_date", models.DateTimeField(blank=True, null=True)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("draft", "Draft"),
                            ("issued", "Issued"),
                            ("paid", "Paid"),
                            ("overdue", "Overdue"),
                            ("cancelled", "Cancelled"),
                        ],
                        default="issued",
                        max_length=20,
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="consolidated_invoices",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-issued_at"],
            },
        ),
        migrations.CreateModel(
            name="Coupon",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("code", models.CharField(db_index=True, max_length=40, unique=True)),
                ("is_active", models.BooleanField(default=True)),
                ("notes", models.TextField(blank=True, default="")),
                ("valid_from", models.DateTimeField(blank=True, null=True)),
                ("valid_to", models.DateTimeField(blank=True, null=True)),
                ("target_plan_types", models.JSONField(blank=True, default=list)),
                ("target_site_types", models.JSONField(blank=True, default=list)),
                ("target_plan_ids", models.JSONField(blank=True, default=list)),
                ("target_line_kinds", models.JSONField(blank=True, default=list)),
                ("target_extra_charge_types", models.JSONField(blank=True, default=list)),
                (
                    "discount_type",
                    models.CharField(
                        choices=[("percent", "Percent"), ("amount", "Fixed Amount")], default="percent", max_length=10
                    ),
                ),
                ("percent_off", models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ("amount_off", models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                (
                    "max_redemptions",
                    models.PositiveIntegerField(
                        blank=True, help_text="Total times this code can be redeemed (None = unlimited)", null=True
                    ),
                ),
                (
                    "per_user_limit",
                    models.PositiveIntegerField(
                        blank=True, help_text="Max uses per user (None = unlimited)", null=True
                    ),
                ),
                ("applies_to_first_n_cycles", models.PositiveIntegerField(blank=True, null=True)),
                (
                    "stack_policy",
                    models.CharField(
                        choices=[
                            ("none", "No stacking"),
                            ("promo_then_coupon", "Promo first, then coupon"),
                            ("coupon_then_promo", "Coupon first, then promo"),
                        ],
                        default="promo_then_coupon",
                        max_length=30,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_coupons",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ("-created_at",),
            },
        ),
        migrations.CreateModel(
            name="ExtraCharge",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "kit_type_name",
                    models.CharField(
                        choices=[("standard", "Standard Kit"), ("mini", "Mini Kit")], default="standard", max_length=20
                    ),
                ),
                (
                    "charge_type",
                    models.CharField(
                        choices=[
                            ("cable_15m", "15m Cable"),
                            ("cable_45m", "45m Cable"),
                            ("roof_mounting", "Roof Mounting"),
                            ("installation", "Installation"),
                            ("accessories", "Accessories"),
                            ("router", "Router"),
                        ],
                        max_length=20,
                    ),
                ),
                ("price_usd", models.DecimalField(decimal_places=2, max_digits=8)),
                ("is_active", models.BooleanField(default=True)),
            ],
            options={
                "unique_together": {("kit_type_name", "charge_type")},
            },
        ),
        migrations.CreateModel(
            name="FxRate",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("date", models.DateField(db_index=True)),
                ("pair", models.CharField(db_index=True, default="USD/CDF", max_length=15)),
                ("rate", models.DecimalField(decimal_places=4, max_digits=12)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
            options={
                "ordering": ["-date", "pair"],
            },
        ),
        migrations.CreateModel(
            name="InstallationActivity",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("planned_at", models.DateField(blank=True, null=True)),
                ("started_at", models.DateTimeField(blank=True, null=True)),
                ("completed_at", models.DateTimeField(blank=True, null=True)),
                ("notes", models.TextField(blank=True, null=True)),
                ("location_confirmed", models.BooleanField(default=False)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending"),
                            ("in_progress", "In Progress"),
                            ("completed", "Completed"),
                            ("cancelled", "Cancelled"),
                            ("submitted", "Submitted (Under Review)"),
                            ("validated", "Validated"),
                        ],
                        default="pending",
                        max_length=20,
                    ),
                ),
                (
                    "on_site_arrival",
                    models.DateTimeField(
                        blank=True, help_text="Heure d'arrivée du technicien sur site (local)", null=True
                    ),
                ),
                ("site_address", models.TextField(blank=True, help_text="Adresse complète du site d'installation")),
                (
                    "site_latitude",
                    models.DecimalField(
                        blank=True, decimal_places=7, help_text="Latitude GPS du site", max_digits=10, null=True
                    ),
                ),
                (
                    "site_longitude",
                    models.DecimalField(
                        blank=True, decimal_places=7, help_text="Longitude GPS du site", max_digits=10, null=True
                    ),
                ),
                (
                    "access_level",
                    models.CharField(
                        blank=True,
                        choices=[("easy", "Easy"), ("moderate", "Moderate"), ("difficult", "Difficult")],
                        help_text="Niveau d'accès au site",
                        max_length=20,
                    ),
                ),
                (
                    "power_availability",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("stable", "Stable"),
                            ("intermittent", "Intermittent"),
                            ("unavailable", "Unavailable"),
                        ],
                        help_text="Disponibilité de l'alimentation électrique",
                        max_length=20,
                    ),
                ),
                (
                    "site_notes",
                    models.TextField(blank=True, help_text="Notes sur le site (sécurité, toit, dangers, etc.)"),
                ),
                (
                    "dish_serial_number",
                    models.CharField(blank=True, help_text="Numéro de série de l'antenne", max_length=100),
                ),
                (
                    "router_serial_number",
                    models.CharField(blank=True, help_text="Numéro de série du routeur", max_length=100),
                ),
                (
                    "firmware_version",
                    models.CharField(blank=True, help_text="Version du firmware installé", max_length=50),
                ),
                (
                    "power_source",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("main_ac", "Main AC"),
                            ("generator", "Generator"),
                            ("solar", "Solar"),
                            ("ups", "UPS"),
                        ],
                        help_text="Source d'alimentation principale",
                        max_length=20,
                    ),
                ),
                (
                    "cable_length",
                    models.DecimalField(
                        blank=True,
                        decimal_places=1,
                        help_text="Longueur du câble en mètres",
                        max_digits=6,
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "splices_connectors",
                    models.PositiveIntegerField(blank=True, help_text="Nombre d'épissures/connecteurs", null=True),
                ),
                ("wifi_ssid", models.CharField(blank=True, help_text="SSID du réseau Wi-Fi", max_length=100)),
                ("wifi_password", models.CharField(blank=True, help_text="Mot de passe Wi-Fi", max_length=100)),
                (
                    "lan_ip",
                    models.GenericIPAddressField(blank=True, help_text="Adresse IP LAN", null=True, protocol="IPv4"),
                ),
                ("dhcp_range", models.CharField(blank=True, help_text="Plage DHCP (ex: .100 - .200)", max_length=50)),
                (
                    "mount_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("roof", "Roof"),
                            ("wall", "Wall"),
                            ("ground_pole", "Ground Pole"),
                            ("tripod", "Tripod"),
                        ],
                        help_text="Type de montage",
                        max_length=20,
                    ),
                ),
                (
                    "mount_height",
                    models.DecimalField(
                        blank=True,
                        decimal_places=1,
                        help_text="Hauteur du montage en mètres",
                        max_digits=5,
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "grounding",
                    models.CharField(
                        blank=True,
                        choices=[("yes", "Yes"), ("no", "No"), ("na", "N/A")],
                        help_text="Mise à la terre effectuée",
                        max_length=10,
                    ),
                ),
                (
                    "weatherproofing",
                    models.CharField(
                        blank=True,
                        choices=[("taped", "Taped"), ("sealed", "Sealed"), ("conduit", "Conduit"), ("na", "N/A")],
                        help_text="Méthode d'étanchéité",
                        max_length=20,
                    ),
                ),
                (
                    "obstruction_percentage",
                    models.PositiveIntegerField(
                        blank=True,
                        help_text="Pourcentage d'obstruction (0-100%)",
                        null=True,
                        validators=[django.core.validators.MaxValueValidator(100)],
                    ),
                ),
                (
                    "elevation_angle",
                    models.DecimalField(
                        blank=True, decimal_places=1, help_text="Angle d'élévation en degrés", max_digits=5, null=True
                    ),
                ),
                (
                    "azimuth_angle",
                    models.DecimalField(
                        blank=True, decimal_places=1, help_text="Angle azimut en degrés", max_digits=5, null=True
                    ),
                ),
                (
                    "obstruction_notes",
                    models.CharField(
                        blank=True, help_text="Notes sur les obstructions (arbres, bâtiments, etc.)", max_length=255
                    ),
                ),
                (
                    "mounting_notes",
                    models.TextField(blank=True, help_text="Notes sur le montage (ancrage, scellant, contraintes)"),
                ),
                (
                    "weather_conditions",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("sunny", "Sunny"),
                            ("cloudy", "Cloudy"),
                            ("rainy", "Rainy"),
                            ("windy", "Windy"),
                            ("stormy", "Stormy"),
                            ("other", "Other"),
                        ],
                        help_text="Conditions météo pendant l'installation",
                        max_length=20,
                    ),
                ),
                ("safety_helmet", models.BooleanField(default=False, help_text="Casque utilisé")),
                ("safety_harness", models.BooleanField(default=False, help_text="Harnais utilisé")),
                ("safety_gloves", models.BooleanField(default=False, help_text="Gants utilisés")),
                ("safety_ladder", models.BooleanField(default=False, help_text="Sécurité échelle respectée")),
                (
                    "hazards_noted",
                    models.TextField(
                        blank=True, help_text="Dangers notés (électrique, instabilité toit, animaux, etc.)"
                    ),
                ),
                (
                    "cable_entry_point",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("wall_drilled", "Wall Drilled"),
                            ("window_feed", "Window Feed"),
                            ("conduit", "Conduit"),
                            ("existing_duct", "Existing Duct"),
                        ],
                        help_text="Point d'entrée du câble",
                        max_length=20,
                    ),
                ),
                (
                    "cable_protection",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("conduit", "Conduit"),
                            ("trunking", "Trunking"),
                            ("uv_protected", "UV Protected"),
                            ("none", "None"),
                        ],
                        help_text="Protection du câble",
                        max_length=20,
                    ),
                ),
                (
                    "termination_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("rj45", "RJ45"),
                            ("poe_injector", "POE Injector"),
                            ("direct", "Direct"),
                            ("other", "Other"),
                        ],
                        help_text="Type de terminaison",
                        max_length=20,
                    ),
                ),
                (
                    "routing_notes",
                    models.CharField(
                        blank=True,
                        help_text="Notes sur le cheminement (chemin, pénétrations, scellant)",
                        max_length=255,
                    ),
                ),
                (
                    "power_stability_test",
                    models.CharField(
                        blank=True,
                        choices=[("pass", "Pass"), ("fail", "Fail")],
                        help_text="Test de stabilité de l'alimentation",
                        max_length=10,
                    ),
                ),
                (
                    "ups_installed",
                    models.CharField(
                        blank=True,
                        choices=[("no", "No"), ("yes", "Yes")],
                        help_text="UPS/Backup installé",
                        max_length=10,
                    ),
                ),
                ("ups_model", models.CharField(blank=True, help_text="Modèle de l'UPS (si installé)", max_length=100)),
                (
                    "ups_runtime_minutes",
                    models.PositiveIntegerField(blank=True, help_text="Autonomie de l'UPS en minutes", null=True),
                ),
                (
                    "snr_db",
                    models.DecimalField(
                        blank=True,
                        decimal_places=1,
                        help_text="SNR (Signal-to-Noise Ratio) en dB",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "speed_download_mbps",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Vitesse de téléchargement en Mbps",
                        max_digits=8,
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "speed_upload_mbps",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Vitesse d'upload en Mbps",
                        max_digits=8,
                        null=True,
                        validators=[django.core.validators.MinValueValidator(0)],
                    ),
                ),
                (
                    "latency_ms",
                    models.PositiveIntegerField(blank=True, help_text="Latence en millisecondes", null=True),
                ),
                (
                    "test_tool",
                    models.CharField(
                        blank=True, help_text="Outil de test utilisé (ex: Fast.com, Ookla)", max_length=100
                    ),
                ),
                (
                    "public_ip",
                    models.GenericIPAddressField(
                        blank=True, help_text="Adresse IP publique (si statique)", null=True, protocol="IPv4"
                    ),
                ),
                (
                    "qos_vlan",
                    models.CharField(
                        blank=True, help_text="Configuration QoS/VLAN (ex: VLAN 20, QoS 10Mbps)", max_length=100
                    ),
                ),
                (
                    "final_link_status",
                    models.CharField(
                        blank=True,
                        choices=[("connected", "Connected"), ("not_connected", "Not Connected")],
                        help_text="État final de la connexion",
                        max_length=20,
                    ),
                ),
                (
                    "test_notes",
                    models.TextField(blank=True, help_text="Notes sur les tests (environnement, heure, observations)"),
                ),
                ("customer_full_name", models.CharField(blank=True, help_text="Nom complet du client", max_length=255)),
                (
                    "customer_id_document",
                    models.CharField(
                        blank=True, help_text="Numéro de document d'identité du client (optionnel)", max_length=100
                    ),
                ),
                (
                    "customer_acceptance",
                    models.BooleanField(
                        default=False, help_text="Le client confirme que l'installation est complète et fonctionnelle"
                    ),
                ),
                (
                    "customer_signature",
                    models.TextField(blank=True, help_text="Données de signature du client (base64 canvas data)"),
                ),
                (
                    "customer_signoff_at",
                    models.DateTimeField(blank=True, help_text="Heure de signature du client", null=True),
                ),
                (
                    "customer_rating",
                    models.PositiveIntegerField(
                        blank=True,
                        help_text="Note d'installation (1-5 étoiles)",
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(5),
                        ],
                    ),
                ),
                (
                    "customer_comments",
                    models.TextField(blank=True, help_text="Commentaires du client sur l'installation"),
                ),
                (
                    "reseller_name",
                    models.CharField(blank=True, help_text="Nom du revendeur/partenaire", max_length=255),
                ),
                ("reseller_id", models.CharField(blank=True, help_text="ID/Compte du revendeur", max_length=100)),
                (
                    "sla_tier",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("standard_48h", "Standard (48h)"),
                            ("priority_24h", "Priority (24h)"),
                            ("premium_same_day", "Premium (Same-day)"),
                        ],
                        help_text="Niveau de SLA",
                        max_length=20,
                    ),
                ),
                (
                    "reseller_notes",
                    models.TextField(
                        blank=True, help_text="Notes internes (commentaires, références stock, approbations)"
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True, help_text="Date de création")),
                ("updated_at", models.DateTimeField(auto_now=True, help_text="Dernière mise à jour")),
                (
                    "submitted_at",
                    models.DateTimeField(blank=True, help_text="Date de soumission finale du rapport", null=True),
                ),
                ("is_draft", models.BooleanField(default=True, help_text="Rapport en brouillon (non soumis)")),
                (
                    "edit_deadline",
                    models.DateTimeField(
                        blank=True, help_text="Date limite pour éditer le rapport après soumission (24h)", null=True
                    ),
                ),
                (
                    "validated_at",
                    models.DateTimeField(
                        blank=True, help_text="Date de validation finale (fin de la période d'édition)", null=True
                    ),
                ),
                (
                    "version_number",
                    models.PositiveIntegerField(
                        default=1, help_text="Numéro de version du rapport (pour l'historique)"
                    ),
                ),
                (
                    "last_edited_at",
                    models.DateTimeField(
                        blank=True, help_text="Date de la dernière modification après soumission", null=True
                    ),
                ),
                (
                    "activation_requested",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="True if an activation request was created for this activity",
                    ),
                ),
                (
                    "technician",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="installations",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Installation Activity",
                "verbose_name_plural": "Installation Activities",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="InstallationFee",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("amount_usd", models.DecimalField(decimal_places=2, max_digits=8)),
                (
                    "region",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="installation_fees",
                        to="geo_regions.region",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="InstallationPhoto",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "image",
                    models.ImageField(blank=True, null=True, upload_to=main.models.installation_photo_upload_path),
                ),
                (
                    "photo_type",
                    models.CharField(
                        choices=[("before", "Before"), ("after", "After"), ("evidence", "Additional Evidence")],
                        default="evidence",
                        help_text="Type of photo: before, after, or additional evidence",
                        max_length=10,
                    ),
                ),
                ("uploaded_at", models.DateTimeField(auto_now_add=True)),
                (
                    "installation_activity",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="photos",
                        to="main.installationactivity",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Invoice",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("number", models.CharField(blank=True, db_index=True, max_length=40, null=True, unique=True)),
                ("currency", models.CharField(default="USD", max_length=3)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("draft", "Draft"),
                            ("issued", "Issued"),
                            ("paid", "Paid"),
                            ("overdue", "Overdue"),
                            ("cancelled", "Cancelled"),
                        ],
                        db_index=True,
                        default="draft",
                        max_length=12,
                    ),
                ),
                ("bill_to_name", models.CharField(blank=True, default="", max_length=180)),
                ("bill_to_address", models.TextField(blank=True, default="")),
                ("tax_regime", models.CharField(default="normal", max_length=20)),
                ("vat_rate_percent", models.DecimalField(decimal_places=2, default=Decimal("16.00"), max_digits=5)),
                ("excise_rate_percent", models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ("issued_at", models.DateTimeField(blank=True, db_index=True, null=True)),
                ("due_at", models.DateTimeField(blank=True, null=True)),
                ("subtotal", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                ("tax_total", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                ("grand_total", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                ("vat_amount", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                ("excise_amount", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                (
                    "consolidated_of",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="child_invoices",
                        to="main.consolidatedinvoice",
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="invoices",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-issued_at", "-id"],
            },
        ),
        migrations.CreateModel(
            name="CreditNote",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("number", models.CharField(db_index=True, max_length=40, unique=True)),
                ("issued_at", models.DateTimeField(auto_now_add=True)),
                ("reason", models.CharField(blank=True, default="", max_length=255)),
                ("total", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                ("user", models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL)),
                (
                    "invoice",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.PROTECT, related_name="credit_notes", to="main.invoice"
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Order",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("latitude", models.FloatField(blank=True, null=True)),
                ("longitude", models.FloatField(blank=True, null=True)),
                ("total_price", models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                (
                    "payment_method",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("mobile", "Mobile Money"),
                            ("bank_transfer", "Bank Transfer"),
                            ("book_my_kit", "Book My Kit (Cash)"),
                        ],
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "payment_status",
                    models.CharField(
                        choices=[
                            ("unpaid", "Unpaid"),
                            ("awaiting_confirmation", "Awaiting confirmation"),
                            ("paid", "Paid"),
                            ("cancelled", "Cancelled"),
                        ],
                        default="unpaid",
                        max_length=30,
                    ),
                ),
                ("proof_of_payment", models.FileField(blank=True, null=True, upload_to="pop_uploads/")),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending_payment", "Pending payment"),
                            ("awaiting_confirmation", "Awaiting confirmation"),
                            ("fulfilled", "Fulfilled"),
                            ("cancelled", "Cancelled"),
                            ("failed", "Failed"),
                        ],
                        default="pending_payment",
                        max_length=50,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True, null=True)),
                (
                    "expires_at",
                    models.DateTimeField(
                        blank=True,
                        db_index=True,
                        help_text="Absolute expiry timestamp set by the view; the model never computes it.",
                        null=True,
                    ),
                ),
                ("cancelled_reason", models.CharField(blank=True, default="", max_length=255)),
                (
                    "is_subscription_renewal",
                    models.BooleanField(
                        default=False, help_text="True if this order was created to renew an existing subscription"
                    ),
                ),
                ("payment_hold_until", models.DateTimeField(blank=True, null=True)),
                (
                    "order_reference",
                    models.CharField(blank=True, db_index=True, editable=False, max_length=20, null=True, unique=True),
                ),
                ("delivery_date", models.DateTimeField(blank=True, null=True)),
                ("is_installed", models.BooleanField(default=False)),
                ("installation_date", models.DateTimeField(blank=True, null=True)),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="created_orders",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "delivered_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="delivered_orders",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "installed_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="installed_orders",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "region",
                    models.ForeignKey(
                        blank=True,
                        help_text="Resolved region for this order",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="orders",
                        to="geo_regions.region",
                    ),
                ),
                (
                    "sales_agent",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="orders_as_sales",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "selected_extra_charges",
                    models.ManyToManyField(
                        blank=True, help_text="Extra charges selected for this order", to="main.extracharge"
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="kit_orders",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="InvoiceOrder",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("amount_excl_tax", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                (
                    "invoice",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="order_links", to="main.invoice"
                    ),
                ),
                (
                    "order",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.PROTECT, related_name="invoice_links", to="main.order"
                    ),
                ),
            ],
        ),
        migrations.AddField(
            model_name="installationactivity",
            name="order",
            field=models.OneToOneField(
                on_delete=django.db.models.deletion.CASCADE, related_name="installation_activity", to="main.order"
            ),
        ),
        migrations.CreateModel(
            name="OrderAddOn",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "order",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="addons", to="main.order"
                    ),
                ),
                ("service", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="main.optionalservice")),
            ],
        ),
        migrations.CreateModel(
            name="OrderLine",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "kind",
                    models.CharField(
                        choices=[
                            ("kit", "Kit"),
                            ("plan", "Subscription Plan"),
                            ("extra", "Extra Charge"),
                            ("install", "Installation Fee"),
                            ("adjust", "Adjustment/Discount"),
                        ],
                        max_length=20,
                    ),
                ),
                ("description", models.CharField(max_length=255)),
                ("quantity", models.PositiveIntegerField(default=1)),
                ("unit_price", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                ("line_total", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                (
                    "extra_charge",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.extracharge"
                    ),
                ),
                (
                    "order",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="lines", to="main.order"
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="InvoiceLine",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("description", models.CharField(max_length=255)),
                ("quantity", models.DecimalField(decimal_places=2, default=Decimal("1.00"), max_digits=12)),
                ("unit_price", models.DecimalField(decimal_places=2, max_digits=12)),
                ("line_total", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                ("kind", models.CharField(default="item", max_length=20)),
                (
                    "invoice",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="lines", to="main.invoice"
                    ),
                ),
                (
                    "order",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.order"
                    ),
                ),
                (
                    "order_line",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.orderline"
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="OrderTax",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("kind", models.CharField(choices=[("VAT", "VAT"), ("EXCISE", "Excise")], max_length=20)),
                ("rate", models.DecimalField(decimal_places=2, max_digits=6)),
                ("amount", models.DecimalField(decimal_places=2, max_digits=12)),
                (
                    "order",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="taxes", to="main.order"
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="OTPVerification",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("otp", models.CharField(blank=True, max_length=6, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("expires_at", models.DateTimeField(blank=True, null=True)),
                ("is_verified", models.BooleanField(blank=True, default=False, null=True)),
                ("attempt_count", models.PositiveIntegerField(default=0)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="otp_codes",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="PaymentAttempt",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("code", models.CharField(blank=True, max_length=100, null=True)),
                ("reference", models.CharField(blank=True, max_length=100, null=True)),
                ("provider_reference", models.CharField(blank=True, max_length=100, null=True)),
                ("order_number", models.CharField(blank=True, max_length=100, null=True, unique=True)),
                ("amount", models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ("amount_customer", models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ("currency", models.CharField(blank=True, max_length=10, null=True)),
                ("status", models.CharField(blank=True, max_length=20, null=True)),
                (
                    "payment_type",
                    models.CharField(
                        choices=[
                            ("mobile", "Mobile Money"),
                            ("card", "Card Payment"),
                            ("cash", "Cash Payment"),
                            ("terminal", "Terminal"),
                        ],
                        default="mobile",
                        help_text="Type of payment attempted (mobile or card)",
                        max_length=50,
                    ),
                ),
                (
                    "payment_for",
                    models.CharField(
                        choices=[("hardware", "Hardware"), ("subscription", "Subscription")],
                        default="",
                        help_text="What this payment is for",
                        max_length=50,
                    ),
                ),
                ("transaction_time", models.DateTimeField(blank=True, null=True)),
                ("raw_payload", models.JSONField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("last_probed_at", models.DateTimeField(blank=True, null=True)),
                (
                    "last_probed_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="payment_probes",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "order",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="payment_attempts", to="main.order"
                    ),
                ),
                (
                    "processed_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="processed_payments",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="OrderEvent",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "event_type",
                    models.CharField(
                        default="info",
                        help_text="payment_probe | auto_cancel | manual_cancel | note | system",
                        max_length=40,
                    ),
                ),
                ("message", models.CharField(blank=True, default="", max_length=255)),
                ("payload", models.JSONField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "order",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="events", to="main.order"
                    ),
                ),
                (
                    "attempt",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="order_events",
                        to="main.paymentattempt",
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="PaymentProbeLog",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("order_number", models.CharField(blank=True, default="", max_length=100)),
                ("trans_id", models.CharField(blank=True, default="", max_length=100)),
                ("order_reference", models.CharField(blank=True, default="", max_length=100)),
                (
                    "outcome_status",
                    models.CharField(
                        blank=True,
                        default="",
                        help_text="paid | failed | pending | error | mismatch | http_4xx/5xx | unexpected",
                        max_length=20,
                    ),
                ),
                ("orders_updated", models.IntegerField(default=0)),
                ("raw_gateway_code", models.CharField(blank=True, default="", max_length=20)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "attempt",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="probe_logs", to="main.paymentattempt"
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="payment_probe_logs",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="PersonalKYC",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "status",
                    models.CharField(
                        choices=[("pending", "Pending"), ("approved", "Approved"), ("rejected", "Rejected")],
                        default="pending",
                        max_length=20,
                        verbose_name="KYC Status",
                    ),
                ),
                ("approved_at", models.DateTimeField(blank=True, null=True, verbose_name="Approval Date")),
                (
                    "rejection_reason",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("document_quality", "Poor document quality"),
                            ("document_expired", "Document expired"),
                            ("information_mismatch", "Information does not match document"),
                            ("incomplete_documents", "Incomplete documentation"),
                            ("invalid_document", "Invalid or fake document"),
                            ("other", "Other (specify in remarks)"),
                        ],
                        max_length=50,
                        null=True,
                        verbose_name="Rejection Reason",
                    ),
                ),
                ("rejected_at", models.DateTimeField(blank=True, null=True, verbose_name="Rejection Date")),
                ("remarks", models.TextField(blank=True, verbose_name="Remarks")),
                ("full_name", models.CharField(blank=True, max_length=50, null=True)),
                ("date_of_birth", models.DateField(blank=True, null=True, verbose_name="Date of Birth")),
                ("nationality", models.CharField(blank=True, max_length=50, null=True, verbose_name="Nationality")),
                (
                    "id_document_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("voter_card", "Carte d'électeur"),
                            ("drivers_license", "Permis de conduire"),
                            ("passport", "Passeport"),
                        ],
                        max_length=20,
                        null=True,
                        verbose_name="ID Document Type",
                    ),
                ),
                ("document_number", models.CharField(blank=True, max_length=50, null=True, unique=True)),
                ("id_issue_date", models.DateField(blank=True, null=True, verbose_name="ID Issue Date")),
                ("id_expiry_date", models.DateField(blank=True, null=True, verbose_name="ID Expiry Date")),
                ("address", models.CharField(blank=True, max_length=70, null=True)),
                (
                    "document_file",
                    models.FileField(blank=True, null=True, upload_to=main.models.personal_kyc_upload_path),
                ),
                (
                    "visa_last_page",
                    models.FileField(
                        blank=True,
                        help_text="Last page of visa for non-Congolese nationals",
                        null=True,
                        upload_to=main.models.personal_kyc_upload_path,
                    ),
                ),
                ("submitted_at", models.DateTimeField(auto_now_add=True, null=True)),
                (
                    "approved_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="%(class)s_approved_by",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="Approved By",
                    ),
                ),
                (
                    "rejected_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="%(class)s_rejected_by",
                        to=settings.AUTH_USER_MODEL,
                        verbose_name="Rejected By",
                    ),
                ),
                (
                    "user",
                    models.OneToOneField(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="personnal_kyc",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "KYC Record",
                "verbose_name_plural": "KYC Records",
                "ordering": ["-approved_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="Promotion",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("name", models.CharField(max_length=120, unique=True)),
                ("active", models.BooleanField(default=True)),
                ("starts_at", models.DateTimeField(blank=True, null=True)),
                ("ends_at", models.DateTimeField(blank=True, null=True)),
                ("target_plan_types", models.JSONField(blank=True, default=list)),
                ("target_site_types", models.JSONField(blank=True, default=list)),
                ("target_plan_ids", models.JSONField(blank=True, default=list)),
                ("target_line_kinds", models.JSONField(blank=True, default=list)),
                ("target_extra_charge_types", models.JSONField(blank=True, default=list)),
                (
                    "discount_type",
                    models.CharField(
                        choices=[("percent", "Percent"), ("amount", "Fixed Amount")], default="percent", max_length=10
                    ),
                ),
                (
                    "value",
                    models.DecimalField(decimal_places=2, help_text="Percent (e.g. 10.00) or fixed USD", max_digits=8),
                ),
                ("max_uses_total", models.PositiveIntegerField(blank=True, null=True)),
                ("max_uses_per_user", models.PositiveIntegerField(blank=True, null=True)),
                ("new_customers_only", models.BooleanField(default=False)),
                (
                    "stack_policy",
                    models.CharField(
                        choices=[
                            ("none", "No stacking"),
                            ("promo_then_coupon", "Promo first, then coupon"),
                            ("coupon_then_promo", "Coupon first, then promo"),
                        ],
                        default="promo_then_coupon",
                        max_length=30,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={
                "ordering": ("-created_at",),
                "indexes": [
                    models.Index(fields=["active", "starts_at", "ends_at"], name="main_promot_active_64424a_idx"),
                    django.contrib.postgres.indexes.GinIndex(fields=["target_plan_types"], name="promo_gin_plan_types"),
                    django.contrib.postgres.indexes.GinIndex(fields=["target_site_types"], name="promo_gin_site_types"),
                    django.contrib.postgres.indexes.GinIndex(fields=["target_plan_ids"], name="promo_gin_plan_ids"),
                    django.contrib.postgres.indexes.GinIndex(fields=["target_line_kinds"], name="promo_gin_line_kinds"),
                    django.contrib.postgres.indexes.GinIndex(
                        fields=["target_extra_charge_types"], name="promo_gin_extra_types"
                    ),
                ],
            },
        ),
        migrations.CreateModel(
            name="RegionSalesDefault",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("is_primary", models.BooleanField(default=True)),
                (
                    "agent",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="region_defaults",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "region",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="sales_defaults",
                        to="geo_regions.region",
                    ),
                ),
            ],
            options={
                "verbose_name": "Region sales default",
                "verbose_name_plural": "Region sales defaults",
            },
        ),
        migrations.CreateModel(
            name="StarlinkKitInventory",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("kit_number", models.CharField(blank=True, max_length=100, null=True, unique=True)),
                ("serial_number", models.CharField(blank=True, max_length=100, null=True, unique=True)),
                ("model", models.CharField(blank=True, max_length=50, null=True)),
                ("firmware_version", models.CharField(blank=True, max_length=50, null=True)),
                ("is_assigned", models.BooleanField(default=False)),
                ("current_region_name", models.CharField(blank=True, default="", max_length=120)),
                (
                    "condition",
                    models.CharField(
                        choices=[
                            ("new", "New"),
                            ("good", "Good"),
                            ("fair", "Fair"),
                            ("damaged", "Damaged"),
                            ("scrapped", "Scrapped"),
                        ],
                        default="new",
                        max_length=12,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        blank=True,
                        default="available",
                        help_text="Human-readable status (available/assigned/scrapped/etc.)",
                        max_length=20,
                    ),
                ),
                (
                    "assigned_to_order",
                    models.OneToOneField(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="assigned_kit",
                        to="main.order",
                    ),
                ),
                (
                    "kit",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="inventory_items",
                        to="main.starlinkkit",
                    ),
                ),
            ],
        ),
        migrations.AddField(
            model_name="orderline",
            name="kit_inventory",
            field=models.ForeignKey(
                blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.starlinkkitinventory"
            ),
        ),
        migrations.AddField(
            model_name="order",
            name="kit_inventory",
            field=models.OneToOneField(
                blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.starlinkkitinventory"
            ),
        ),
        migrations.CreateModel(
            name="StarlinkKitMovement",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "movement_type",
                    models.CharField(
                        choices=[
                            ("received", "Received"),
                            ("assigned", "Assigned to Order"),
                            ("returned", "Returned"),
                            ("transferred", "Transferred"),
                            ("scrapped", "Scrapped / Defective"),
                            ("adjusted", "Inventory Adjustment"),
                        ],
                        max_length=20,
                    ),
                ),
                ("timestamp", models.DateTimeField(default=django.utils.timezone.now)),
                ("location", models.CharField(blank=True, max_length=100, null=True)),
                ("note", models.TextField(blank=True, null=True)),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who recorded this movement",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "inventory_item",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="movements",
                        to="main.starlinkkitinventory",
                    ),
                ),
                (
                    "order",
                    models.ForeignKey(
                        blank=True,
                        help_text="Optional: Order associated with this movement",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="kit_movements",
                        to="main.order",
                    ),
                ),
            ],
            options={
                "verbose_name": "Starlink Kit Movement",
                "verbose_name_plural": "Starlink Kit Movements",
                "ordering": ["-timestamp"],
            },
        ),
        migrations.CreateModel(
            name="StockLocation",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("code", models.SlugField(help_text="Short code, e.g. kin-main, van-john, rma", unique=True)),
                ("name", models.CharField(max_length=100, unique=True)),
                ("address", models.CharField(blank=True, default="", max_length=255)),
                ("is_active", models.BooleanField(default=True)),
                (
                    "region",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="stock_locations",
                        to="geo_regions.region",
                    ),
                ),
            ],
            options={
                "ordering": ["name"],
            },
        ),
        migrations.AddField(
            model_name="starlinkkitinventory",
            name="current_location",
            field=models.ForeignKey(
                blank=True,
                help_text="Where this kit currently resides (warehouse/van/customer/RMA, etc.)",
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="kits_here",
                to="main.stocklocation",
            ),
        ),
        migrations.CreateModel(
            name="Subscription",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "status",
                    models.CharField(
                        blank=True,
                        choices=[("active", "Active"), ("suspended", "Suspended"), ("cancelled", "Cancelled")],
                        default="active",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "billing_cycle",
                    models.CharField(
                        choices=[("monthly", "Monthly"), ("quarterly", "Quarterly"), ("yearly", "Yearly")],
                        default="monthly",
                        max_length=20,
                    ),
                ),
                ("started_at", models.DateField(blank=True, null=True)),
                ("next_billing_date", models.DateField(blank=True, null=True)),
                ("last_billed_at", models.DateField(blank=True, null=True)),
                ("ended_at", models.DateField(blank=True, null=True)),
                ("plus_code", models.CharField(blank=True, default="", max_length=64)),
                (
                    "activation_requested",
                    models.BooleanField(
                        default=False, help_text="Has the user requested activation for this subscription?"
                    ),
                ),
                (
                    "order",
                    models.OneToOneField(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.order"
                    ),
                ),
                (
                    "region",
                    models.ForeignKey(
                        blank=True,
                        help_text="Resolved region for this subscription",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="subscriptions",
                        to="geo_regions.region",
                    ),
                ),
                (
                    "sales_agent",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="subscriptions_as_sales",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="active_subscriptions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "plan",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.subscriptionplan"
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="CouponRedemption",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "discount_type",
                    models.CharField(choices=[("percent", "Percent"), ("amount", "Fixed Amount")], max_length=10),
                ),
                ("value", models.DecimalField(decimal_places=2, max_digits=8)),
                ("discounted_amount", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=12)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "coupon",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="redemptions", to="main.coupon"
                    ),
                ),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="coupon_redemptions",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "order",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="coupon_redemptions",
                        to="main.order",
                    ),
                ),
                (
                    "subscription",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="coupon_redemptions",
                        to="main.subscription",
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="AccountEntry",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                (
                    "entry_type",
                    models.CharField(
                        choices=[
                            ("invoice", "Invoice"),
                            ("payment", "Payment"),
                            ("credit_note", "Credit Note"),
                            ("adjustment", "Adjustment"),
                            ("tax", "Tax"),
                        ],
                        max_length=20,
                    ),
                ),
                ("amount_usd", models.DecimalField(decimal_places=2, max_digits=12)),
                ("description", models.CharField(blank=True, default="", max_length=255)),
                (
                    "snapshot_source",
                    models.CharField(
                        default="auto",
                        help_text="Origin tag for the captured region/agent (auto, manual, backfill, etc.)",
                        max_length=32,
                    ),
                ),
                ("period_start", models.DateField(blank=True, null=True)),
                ("period_end", models.DateField(blank=True, null=True)),
                ("external_ref", models.CharField(blank=True, default="", max_length=64)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "region_snapshot",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="account_entries",
                        to="geo_regions.region",
                    ),
                ),
                (
                    "sales_agent_snapshot",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="sales_dim_entries",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "account",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="entries", to="main.billingaccount"
                    ),
                ),
                (
                    "order",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="billing_entries",
                        to="main.order",
                    ),
                ),
                (
                    "payment",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="entries",
                        to="main.paymentattempt",
                    ),
                ),
                (
                    "subscription",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="billing_entries",
                        to="main.subscription",
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.AddField(
            model_name="orderline",
            name="plan",
            field=models.ForeignKey(
                blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.subscriptionplan"
            ),
        ),
        migrations.AddField(
            model_name="order",
            name="plan",
            field=models.ForeignKey(
                blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.subscriptionplan"
            ),
        ),
        migrations.CreateModel(
            name="TechnicianAssignment",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("assigned_at", models.DateTimeField(auto_now_add=True)),
                ("returned_at", models.DateTimeField(blank=True, null=True)),
                ("is_active", models.BooleanField(default=True)),
                ("note", models.TextField(blank=True, null=True)),
                (
                    "assigned_by",
                    models.ForeignKey(
                        blank=True,
                        help_text="User who made the assignment",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="kit_assignments_made",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "inventory_item",
                    models.ForeignKey(
                        help_text="Starlink Kit Inventory item assigned",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="technician_assignments",
                        to="main.starlinkkitinventory",
                    ),
                ),
                (
                    "technician",
                    models.ForeignKey(
                        help_text="Technician assigned the kit",
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="assigned_kits",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "verbose_name": "Technician Assignment",
                "verbose_name_plural": "Technician Assignments",
                "ordering": ["-assigned_at"],
            },
        ),
        migrations.CreateModel(
            name="Ticket",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("subject", models.CharField(max_length=200)),
                (
                    "category",
                    models.CharField(
                        choices=[
                            ("technical", "Technical"),
                            ("billing", "Billing"),
                            ("account", "Account"),
                            ("other", "Other"),
                        ],
                        db_index=True,
                        default="technical",
                        max_length=20,
                    ),
                ),
                (
                    "priority",
                    models.CharField(
                        choices=[("low", "Low"), ("normal", "Normal"), ("high", "High")],
                        db_index=True,
                        default="normal",
                        max_length=10,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[("open", "Open"), ("pending", "Pending"), ("closed", "Closed")],
                        db_index=True,
                        default="open",
                        max_length=10,
                    ),
                ),
                ("message", models.TextField()),
                ("created_at", models.DateTimeField(auto_now_add=True, db_index=True)),
                ("updated_at", models.DateTimeField(auto_now=True, db_index=True)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="tickets", to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
            options={
                "ordering": ("-updated_at",),
            },
        ),
        migrations.CreateModel(
            name="UserPreferences",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("avatar", models.ImageField(blank=True, null=True, upload_to="avatars/")),
                ("twofa_enabled", models.BooleanField(default=False)),
                ("notify_updates", models.BooleanField(default=True)),
                ("notify_billing", models.BooleanField(default=True)),
                ("notify_tickets", models.BooleanField(default=True)),
                (
                    "user",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE, related_name="prefs", to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Wallet",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("currency", models.CharField(default="USD", max_length=10)),
                ("balance", models.DecimalField(decimal_places=2, default=Decimal("0.00"), max_digits=14)),
                ("is_active", models.BooleanField(default=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "user",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE, related_name="wallet", to=settings.AUTH_USER_MODEL
                    ),
                ),
            ],
            options={
                "verbose_name": "Wallet",
                "verbose_name_plural": "Wallets",
            },
        ),
        migrations.CreateModel(
            name="WalletTransaction",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("tx_type", models.CharField(choices=[("credit", "Credit"), ("debit", "Debit")], max_length=10)),
                ("amount", models.DecimalField(decimal_places=2, max_digits=14)),
                ("currency", models.CharField(default="USD", max_length=10)),
                ("note", models.CharField(blank=True, default="", max_length=120)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "order",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="wallet_transactions",
                        to="main.order",
                    ),
                ),
                (
                    "payment_attempt",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="wallet_transactions",
                        to="main.paymentattempt",
                    ),
                ),
                (
                    "wallet",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="transactions", to="main.wallet"
                    ),
                ),
            ],
            options={
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="InvoicePayment",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("amount", models.DecimalField(decimal_places=2, max_digits=12)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "invoice",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="payments", to="main.invoice"
                    ),
                ),
                (
                    "payment_attempt",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.paymentattempt"
                    ),
                ),
                (
                    "wallet_tx",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to="main.wallettransaction"
                    ),
                ),
            ],
        ),
        migrations.AddIndex(
            model_name="companykyc",
            index=models.Index(fields=["user", "status"], name="main_compan_user_id_461b4c_idx"),
        ),
        migrations.AddIndex(
            model_name="companykyc",
            index=models.Index(fields=["submitted_at", "status"], name="main_compan_submitt_4beaa2_idx"),
        ),
        migrations.AddConstraint(
            model_name="companykyc",
            constraint=models.UniqueConstraint(
                condition=models.Q(("rccm__isnull", False), models.Q(("rccm", ""), _negated=True)),
                fields=("rccm",),
                name="company_kyc_unique_rccm",
            ),
        ),
        migrations.AddConstraint(
            model_name="companykyc",
            constraint=models.UniqueConstraint(
                condition=models.Q(("nif__isnull", False), models.Q(("nif", ""), _negated=True)),
                fields=("nif",),
                name="company_kyc_unique_nif",
            ),
        ),
        migrations.AddConstraint(
            model_name="companykyc",
            constraint=models.UniqueConstraint(
                condition=models.Q(("id_nat__isnull", False), models.Q(("id_nat", ""), _negated=True)),
                fields=("id_nat",),
                name="company_kyc_unique_id_nat",
            ),
        ),
        migrations.AddIndex(
            model_name="companydocument",
            index=models.Index(fields=["company_kyc", "document_type"], name="main_compan_company_23225c_idx"),
        ),
        migrations.AddIndex(
            model_name="companydocument",
            index=models.Index(fields=["is_verified", "uploaded_at"], name="main_compan_is_veri_4b0a33_idx"),
        ),
        migrations.AlterUniqueTogether(
            name="companydocument",
            unique_together={("company_kyc", "document_type")},
        ),
        migrations.AddIndex(
            model_name="consolidatedinvoice",
            index=models.Index(fields=["user", "-issued_at"], name="main_consol_user_id_b57bda_idx"),
        ),
        migrations.AddIndex(
            model_name="consolidatedinvoice",
            index=models.Index(fields=["status"], name="main_consol_status_bd2329_idx"),
        ),
        migrations.AddConstraint(
            model_name="consolidatedinvoice",
            constraint=models.UniqueConstraint(
                condition=models.Q(("number__isnull", True), _negated=True),
                fields=("number",),
                name="uniq_consolidated_number_not_null",
            ),
        ),
        migrations.AddIndex(
            model_name="coupon",
            index=models.Index(fields=["code"], name="main_coupon_code_5bdbf2_idx"),
        ),
        migrations.AddIndex(
            model_name="coupon",
            index=models.Index(fields=["is_active", "valid_from", "valid_to"], name="main_coupon_is_acti_b3bddc_idx"),
        ),
        migrations.AddIndex(
            model_name="coupon",
            index=django.contrib.postgres.indexes.GinIndex(fields=["target_plan_types"], name="coupon_gin_plan_types"),
        ),
        migrations.AddIndex(
            model_name="coupon",
            index=django.contrib.postgres.indexes.GinIndex(fields=["target_site_types"], name="coupon_gin_site_types"),
        ),
        migrations.AddIndex(
            model_name="coupon",
            index=django.contrib.postgres.indexes.GinIndex(fields=["target_plan_ids"], name="coupon_gin_plan_ids"),
        ),
        migrations.AddIndex(
            model_name="coupon",
            index=django.contrib.postgres.indexes.GinIndex(fields=["target_line_kinds"], name="coupon_gin_line_kinds"),
        ),
        migrations.AddIndex(
            model_name="coupon",
            index=django.contrib.postgres.indexes.GinIndex(
                fields=["target_extra_charge_types"], name="coupon_gin_extra_types"
            ),
        ),
        migrations.AddIndex(
            model_name="fxrate",
            index=models.Index(fields=["pair", "-date"], name="main_fxrate_pair_0614d6_idx"),
        ),
        migrations.AlterUniqueTogether(
            name="fxrate",
            unique_together={("date", "pair")},
        ),
        migrations.AlterUniqueTogether(
            name="installationfee",
            unique_together={("region",)},
        ),
        migrations.AddIndex(
            model_name="invoice",
            index=models.Index(fields=["user", "status", "-issued_at"], name="main_invoic_user_id_96925e_idx"),
        ),
        migrations.AddConstraint(
            model_name="invoice",
            constraint=models.UniqueConstraint(
                condition=models.Q(("number__isnull", True), _negated=True),
                fields=("number",),
                name="uniq_invoice_number_not_null",
            ),
        ),
        migrations.AddIndex(
            model_name="invoiceorder",
            index=models.Index(fields=["order", "invoice"], name="main_invoic_order_i_ee3823_idx"),
        ),
        migrations.AlterUniqueTogether(
            name="invoiceorder",
            unique_together={("invoice", "order")},
        ),
        migrations.AddIndex(
            model_name="installationactivity",
            index=models.Index(fields=["order", "technician"], name="main_instal_order_i_56a4aa_idx"),
        ),
        migrations.AddIndex(
            model_name="installationactivity",
            index=models.Index(fields=["created_at"], name="main_instal_created_03a98d_idx"),
        ),
        migrations.AddIndex(
            model_name="installationactivity",
            index=models.Index(fields=["is_draft"], name="main_instal_is_draf_8cc033_idx"),
        ),
        migrations.AddIndex(
            model_name="installationactivity",
            index=models.Index(fields=["status"], name="main_instal_status_47d910_idx"),
        ),
        migrations.AddIndex(
            model_name="installationactivity",
            index=models.Index(fields=["submitted_at"], name="main_instal_submitt_5bd469_idx"),
        ),
        migrations.AddIndex(
            model_name="installationactivity",
            index=models.Index(fields=["edit_deadline"], name="main_instal_edit_de_4bef72_idx"),
        ),
        migrations.AddIndex(
            model_name="installationactivity",
            index=models.Index(fields=["validated_at"], name="main_instal_validat_fa630e_idx"),
        ),
        migrations.AddIndex(
            model_name="orderevent",
            index=models.Index(fields=["order", "-created_at"], name="main_ordere_order_i_d8463c_idx"),
        ),
        migrations.AddIndex(
            model_name="orderevent",
            index=models.Index(fields=["event_type"], name="main_ordere_event_t_86ea1d_idx"),
        ),
        migrations.AddIndex(
            model_name="paymentprobelog",
            index=models.Index(fields=["attempt", "-created_at"], name="main_paymen_attempt_92823c_idx"),
        ),
        migrations.AddIndex(
            model_name="paymentprobelog",
            index=models.Index(fields=["created_at"], name="main_paymen_created_640ab2_idx"),
        ),
        migrations.AddIndex(
            model_name="paymentprobelog",
            index=models.Index(fields=["outcome_status"], name="main_paymen_outcome_3cea0c_idx"),
        ),
        migrations.AddConstraint(
            model_name="regionsalesdefault",
            constraint=models.UniqueConstraint(fields=("region", "agent"), name="uniq_region_agent_default"),
        ),
        migrations.AddConstraint(
            model_name="regionsalesdefault",
            constraint=models.UniqueConstraint(
                condition=models.Q(("is_primary", True)), fields=("region",), name="uniq_primary_region_default"
            ),
        ),
        migrations.AddIndex(
            model_name="starlinkkitinventory",
            index=models.Index(fields=["current_location"], name="main_starli_current_142aac_idx"),
        ),
        migrations.AddIndex(
            model_name="starlinkkitinventory",
            index=models.Index(fields=["status"], name="main_starli_status_3e39f2_idx"),
        ),
        migrations.AddIndex(
            model_name="starlinkkitinventory",
            index=models.Index(fields=["condition"], name="main_starli_conditi_ebd75f_idx"),
        ),
        migrations.AddIndex(
            model_name="couponredemption",
            index=models.Index(fields=["coupon", "user"], name="main_coupon_coupon__6e947f_idx"),
        ),
        migrations.AddIndex(
            model_name="couponredemption",
            index=models.Index(fields=["user", "created_at"], name="main_coupon_user_id_d4221c_idx"),
        ),
        migrations.AddConstraint(
            model_name="couponredemption",
            constraint=models.UniqueConstraint(
                condition=models.Q(("order__isnull", False)),
                fields=("coupon", "order"),
                name="uniq_coupon_once_per_order",
            ),
        ),
        migrations.AddIndex(
            model_name="accountentry",
            index=models.Index(fields=["account", "created_at"], name="main_accoun_account_39632a_idx"),
        ),
        migrations.AddIndex(
            model_name="accountentry",
            index=models.Index(fields=["entry_type"], name="main_accoun_entry_t_e65503_idx"),
        ),
        migrations.AddIndex(
            model_name="accountentry",
            index=models.Index(
                fields=["subscription", "period_start", "period_end"], name="main_accoun_subscri_789d22_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="accountentry",
            index=models.Index(fields=["region_snapshot", "created_at"], name="main_accoun_region__1eee76_idx"),
        ),
        migrations.AddIndex(
            model_name="accountentry",
            index=models.Index(fields=["sales_agent_snapshot", "created_at"], name="main_accoun_sales_a_07536f_idx"),
        ),
        migrations.AddConstraint(
            model_name="accountentry",
            constraint=models.CheckConstraint(
                condition=models.Q(("amount_usd__isnull", False)), name="acct_entry_amount_not_null"
            ),
        ),
        migrations.AddConstraint(
            model_name="accountentry",
            constraint=models.UniqueConstraint(
                condition=models.Q(("entry_type", "invoice")),
                fields=("subscription", "entry_type", "period_start", "period_end"),
                name="uniq_invoice_per_subscription_period",
            ),
        ),
        migrations.AlterUniqueTogether(
            name="technicianassignment",
            unique_together={("technician", "inventory_item")},
        ),
        migrations.AddIndex(
            model_name="ticket",
            index=models.Index(fields=["user", "-updated_at"], name="main_ticket_user_id_fb8525_idx"),
        ),
        migrations.AddIndex(
            model_name="ticket",
            index=models.Index(fields=["status"], name="main_ticket_status_efb522_idx"),
        ),
        migrations.AddIndex(
            model_name="ticket",
            index=models.Index(fields=["category"], name="main_ticket_categor_f7d165_idx"),
        ),
        migrations.AddIndex(
            model_name="ticket",
            index=models.Index(fields=["priority"], name="main_ticket_priorit_3ec606_idx"),
        ),
        migrations.AddConstraint(
            model_name="wallettransaction",
            constraint=models.CheckConstraint(condition=models.Q(("amount__gt", 0)), name="wallet_tx_amount_positive"),
        ),
        migrations.AddConstraint(
            model_name="wallettransaction",
            constraint=models.UniqueConstraint(
                condition=models.Q(("tx_type", "credit")),
                fields=("wallet", "payment_attempt"),
                name="uniq_wallet_credit_per_attempt",
            ),
        ),
    ]
