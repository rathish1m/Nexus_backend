{% extends 'fe_dashboard_main.html' %}
{% load static i18n %}

{% block content %}
<div class="w-full px-6 py-6">

  <!-- ========== HEADER ========== -->
  <header class="rounded-2xl bg-gradient-to-r from-emerald-500 via-green-500 to-teal-400 p-6 shadow-lg text-white mb-8">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div class="flex items-center gap-3">
        <span class="inline-grid place-items-center w-12 h-12 rounded-xl bg-white/15 ring-1 ring-white/20">
          <i class="fas fa-check-circle text-2xl"></i>
        </span>
        <div>
          <h1 class="text-2xl sm:text-3xl font-extrabold tracking-tight">{% trans "Installations finies" %}</h1>
          <p class="text-emerald-100 text-sm mt-1">{% trans "Tous les rapports d'installation soumis avec succès" %}</p>
        </div>
      </div>
      <div class="flex items-center gap-2">
        <span class="text-white/90 font-medium">
          <i class="fas fa-clipboard-check mr-2"></i>{{ total_count }} {% trans "rapports soumis" %}
        </span>
      </div>
    </div>
  </header>

  <!-- ========== TABLEAU DES INSTALLATIONS FINIES ========== -->
  <section class="bg-white rounded-2xl shadow-lg overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead class="bg-gradient-to-r from-emerald-50 to-teal-50 border-b-2 border-emerald-200">
          <tr>
            <th class="px-4 py-3 text-left font-semibold text-emerald-800">#</th>
            <th class="px-4 py-3 text-left font-semibold text-emerald-800">{% trans "Référence commande" %}</th>
            <th class="px-4 py-3 text-left font-semibold text-emerald-800">{% trans "Client" %}</th>
            <th class="px-4 py-3 text-left font-semibold text-emerald-800">{% trans "Téléphone" %}</th>
            <th class="px-4 py-3 text-left font-semibold text-emerald-800">{% trans "Technicien" %}</th>
            <th class="px-4 py-3 text-left font-semibold text-emerald-800">{% trans "Date installation" %}</th>
            <th class="px-4 py-3 text-left font-semibold text-emerald-800">{% trans "Date soumission" %}</th>
            <th class="px-4 py-3 text-left font-semibold text-emerald-800">{% trans "Note client" %}</th>
            <th class="px-4 py-3 text-center font-semibold text-emerald-800">{% trans "Actions" %}</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-100">
          {% for installation in page_obj %}
          <tr class="hover:bg-emerald-50/50 transition">
            <td class="px-4 py-3">{{ forloop.counter }}</td>
            <td class="px-4 py-3 font-medium">{{ installation.order.order_reference|default:"—" }}</td>
            <td class="px-4 py-3">{{ installation.order.user.full_name|default:"N/A" }}</td>
            <td class="px-4 py-3">{{ installation.order.user.phone|default:"—" }}</td>
            <td class="px-4 py-3">
              <span class="inline-flex items-center gap-2 px-2 py-1 rounded-full bg-blue-100 text-blue-700 text-xs">
                <i class="fas fa-user"></i> {{ installation.technician.full_name|default:"N/A" }}
              </span>
            </td>
            <td class="px-4 py-3">
              {% if installation.completed_at %}
                {{ installation.completed_at|date:"d/m/Y H:i" }}
              {% else %}
                —
              {% endif %}
            </td>
            <td class="px-4 py-3">
              {% if installation.submitted_at %}
                <span class="inline-flex items-center gap-2 px-2 py-1 rounded bg-emerald-100 text-emerald-700 text-xs">
                  <i class="fas fa-calendar-check"></i> {{ installation.submitted_at|date:"d/m/Y H:i" }}
                </span>
              {% else %}
                —
              {% endif %}
            </td>
            <td class="px-4 py-3 text-center">
              {% if installation.customer_rating %}
                <span class="inline-flex items-center gap-1">
                  <i class="fas fa-star text-yellow-500"></i>
                  <span class="font-semibold">{{ installation.customer_rating }}/5</span>
                </span>
              {% else %}
                <span class="text-gray-400">—</span>
              {% endif %}
            </td>
            <td class="px-4 py-3">
              <div class="flex justify-center gap-2">
                <a href="#"
                   onclick="viewReport({{ installation.id }}); return false;"
                   class="inline-flex items-center gap-2 px-3 py-1.5 rounded bg-indigo-600 text-white text-xs hover:bg-indigo-700">
                  <i class="fas fa-eye"></i> {% trans "Voir rapport" %}
                </a>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="9" class="px-4 py-12 text-center text-gray-500">
              <i class="fas fa-inbox text-4xl mb-3 text-gray-300"></i>
              <p class="text-lg">{% trans "Aucune installation terminée pour le moment" %}</p>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex items-center justify-between">
      <div class="text-sm text-gray-600">
        {% trans "Page" %} {{ page_obj.number }} {% trans "sur" %} {{ page_obj.paginator.num_pages }}
      </div>
      <div class="flex gap-2">
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}"
           class="px-3 py-1.5 rounded bg-white border border-gray-300 text-gray-700 hover:bg-gray-50">
          <i class="fas fa-chevron-left"></i> {% trans "Précédent" %}
        </a>
        {% endif %}
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}"
           class="px-3 py-1.5 rounded bg-white border border-gray-300 text-gray-700 hover:bg-gray-50">
          {% trans "Suivant" %} <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </section>
</div>

<script>
function viewReport(installationId) {
  alert(`Fonction de visualisation du rapport #${installationId} à implémenter`);
  // TODO: Ouvrir une modal ou rediriger vers une page de détail du rapport
}
</script>
{% endblock %}
